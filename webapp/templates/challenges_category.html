{% extends "base.html" %}
{% block title %}pwncrates - {{category}}{% endblock %}

{% block content %}
<div class="d-flex flex-row justify-content-start mb-5">
  <a href="/challenges" class="me-3">
    <button class="btn" style="width: fit-content;">
      <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-arrow-left-square" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm11.5 5.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
      </svg>
    </button>
  </a>
  <div class="filter w-100">
      <select id="difficulty-filter" name="difficulty-filter" autocomplete="off" onChange="showSelectedDifficulty()">
          <option value="all">All</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
      </select>
  </div>
</div>
<div id="challenge_submission" class="challenge_submission row">
{% for name, subcategory_description, challenges in subcategories %}
<div class="challenge-category accordion accordion-flush show-all">
    <h4>{{ name }}</h4>
    <p>{{ subcategory_description }}</p>
    {% for challenge_id, name, description, points, url, challenge_solves, handout, difficulty in challenges %}
      <div class="accordion-item border challenge {{difficulty}}" id="{{challenge_id}}">
        <div class="accordion-header">
          <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#{{challenge_id}}-info" aria-controls="{{challenge_id}}-info">
            <div class="d-flex flex-row justify-content-between w-100">
              <div>
                <h4 class="mb-0 challenge-name {% if challenge_id in solves %}solved{% endif %}">[{{points}}] {{name}}</h4>
              </div>
              <a href="/solves/{{challenge_id}}" class="solves_link py-1 px-2 me-3 rounded border"><h4 class="mb-0">{{challenge_solves}} solves</h4></a>
            </div>
          </button>
        </div>
        <div id="{{challenge_id}}-info" class="accordion-collapse collapse">
          <div class="accordion-body">
                <p>
                    {{description | safe}}
                </p>
                {% if url != "Null" %}
                <div class="code-block"><p>
                    {{ url }}
                </p></div>
                {% endif %}

                {% if handout != "" %}
                <a href="{{ url_for('static', filename='handouts/' + handout) }}">Download files</a>
                {% endif %}

                {% if current_user.is_authenticated %}
                <p id="solved" style="{% if challenge_id not in solves %}display: none;{% endif %}">
                    Solved! <a href="{{ url_for('writeups', challenge_id=challenge_id ) }}">View writeups</a>
                </p>
                <form onSubmit="handleChallengeSubmission(event)" challenge="{{challenge_id}}" style="{% if challenge_id in solves %}display: none;{% endif %}"
                      method="POST" action="/api/challenges/submit/{{challenge_id}}">
                    <div class="input-group mb-3">
                        <input type="text" name="flag" class="form-control" autocomplete="off" placeholder="Submit flag" id="{{challenge_id}}">
                        <button class="btn btn-primary" type="submit" id="button-addon2">Submit</button>
                    </div>
                </form>
                {% else %}
                <p>
                    <i>You must be logged in to submit flags</i>
                </p>
                {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
</div>
{% endfor %}
  </div>
{% endblock %}